version: "3"

volumes:
    database:
        driver: "local"

networks:
    app:

services:
    database:
        image: "mysql:8.2"
        restart: "always"
        environment:
            TZ: "Europe/Berlin" # ADJUST
            MYSQL_ROOT_PASSWORD: "opencoursematch" # ADJUST
            MYSQL_DATABASE: "opencoursematch"
            MYSQL_USER: "opencoursematch"
            MYSQL_PASSWORD: "opencoursematch" # ADJUST
        volumes:
            - "database:/var/lib/mysql"
        networks:
            - "app"

    app:
        image: "ghcr.io/opencoursematch/opencoursematch:latest"
        restart: "always"
        environment:
            TZ: "Europe/Berlin" # ADJUST
        volumes:
            - "./secrets:/app/secrets"
            - "./app-logs:/app/logs"
            - "./app-files:/app/files"
        ports:
            - "80:80"
        networks:
            - "app"

    backup:
        image: "ghcr.io/jensostertag/mysql-backup:latest"
        restart: "always"
        environment:
            TZ: "Europe/Berlin" # ADJUST
            DB_HOST: "database"
            DB_USER: "opencoursematch"
            DB_PASS: "opencoursematch" # ADJUST
            DB_DATABASE: "opencoursematch"
        volumes:
            - "./database-backup:/backup"
